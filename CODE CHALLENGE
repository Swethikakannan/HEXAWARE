---CODE CHALLENGE 

CREATE TABLE Crime ( 
    CrimeID INT PRIMARY KEY, 
    IncidentType VARCHAR(255), 
    IncidentDate DATE, 
    Location VARCHAR(255), 
    Description TEXT, 
    Status VARCHAR(20) 
)  
CREATE TABLE Victim ( 
    VictimID INT PRIMARY KEY, 
    CrimeID INT, 
    Name VARCHAR(255), 
    ContactInfo VARCHAR(255), 
    Injuries VARCHAR(255), 
    FOREIGN KEY (CrimeID) REFERENCES Crime(CrimeID) 
); 
CREATE TABLE Suspect ( 
    SuspectID INT PRIMARY KEY, 
    CrimeID INT, 
    Name VARCHAR(255), 
    Description TEXT, 
    CriminalHistory TEXT, 
    FOREIGN KEY (CrimeID) REFERENCES Crime(CrimeID) 
); 
INSERT INTO Crime (CrimeID, IncidentType, IncidentDate, Location, Description, Status) 
VALUES 
    (1, 'Robbery', '2023-09-15', '123 Main St, Cityville', 'Armed robbery at a convenience store', 'Open'), 
    (2, 'Homicide', '2023-09-20', '456 Elm St, Townsville', 'Investigation into a murder case', 'Under 
Investigation'), 
    (3, 'Theft', '2023-09-10', '789 Oak St, Villagetown', 'Shoplifting incident at a mall', 'Closed') 

    INSERT INTO Victim (VictimID, CrimeID, Name, ContactInfo, Injuries) 
VALUES 
    (1, 1, 'John Doe', 'johndoe@example.com', 'Minor injuries'), 
    (2, 2, 'Jane Smith', 'janesmith@example.com', 'Deceased'), 
(3, 3, 'Alice Johnson', 'alicejohnson@example.com', 'None');
INSERT INTO Suspect (SuspectID, CrimeID, Name, Description, CriminalHistory) 
VALUES 
(1, 1, 'Robber 1', 'Armed and masked robber', 'Previous robbery convictions'), 
(2, 2, 'Unknown', 'Investigation ongoing', NULL), 
(3, 3, 'Suspect 1', 'Shoplifting suspect', 'Prior shoplifting arrests');

ALTER TABLE Crime
ALTER COLUMN Status VARCHAR(225) NOT NULL;

--1
SELECT * FROM Crime WHERE Status = 'OPEN'

--2
SELECT COUNT(*) AS TOTAL_INCIDENT FROM CRIME

--3
SELECT DISTINCT INCIDENTTYPE FROM CRIME

--4
SELECT * FROM CRIME WHERE INCIDENTDATE BETWEEN '2023-09-01' and '2023-09-10'

--5
ALTER TABLE Victim ADD AGE INT
ALTER TABLE Suspect ADD AGE INT


SELECT Name, Age FROM Victim 
UNION 
SELECT Name, Age FROM Suspect
ORDER BY Age DESC

--6
SELECT AVG(Age) AS AvG_Age FROM (
    SELECT Age FROM Victim
    UNION ALL
    SELECT Age FROM Suspect
) AS ALLPERSON

--7
SELECT INCIDENTTYPE , COUNT(*) AS OPENINCIDENT FROM CRIME  WHERE STATUS ='OPEN'
GROUP BY IncidentType

--8 
SELECT Name FROM Victim WHERE Name LIKE '%Doe%'
UNION
SELECT Name FROM Suspect WHERE Name LIKE '%Doe%'

--9
SELECT V.Name,C.Status AS CurrentStatuS FROM Victim V
JOIN Crime C ON V.CrimeID = C.CrimeID
WHERE C.Status IN ('Open', 'Closed')

SELECT * FROM CRIME
SELECT * FROM VICTIM

--10
SELECT DISTINCT C.INCIDENTTYPE FROM Crime C
JOIN VICTIM V ON C.CrimeID = V.CrimeID WHERE V.Age IN (30, 35)
UNION
SELECT DISTINCT C.IncidentType FROM Crime C
JOIN SUSPECT S ON C.CrimeID = s.CrimeID WHERE s.Age IN (30, 35)

--11
SELECT v.Name FROM Victim v
JOIN Crime c ON v.CrimeID = c.CrimeID WHERE c.IncidentType = 'Robbery'
UNION
SELECT s.Name FROM Suspect s
JOIN Crime c ON s.CrimeID = c.CrimeID WHERE c.IncidentType = 'Robbery'

--12
SELECT IncidentType, COUNT(*) AS OpenCount FROM Crime WHERE Status = 'Open'
GROUP BY IncidentType
HAVING COUNT(*) > 1

--13
SELECT DISTINCT c.CrimeID, c.IncidentType FROM Crime c
JOIN Victim v ON c.CrimeID = v.CrimeID
JOIN Suspect s ON c.CrimeID = s.CrimeID
WHERE v.Name = s.Name

--14
SELECT c.CrimeID, c.IncidentType, v.Name AS VictimName, s.Name AS SuspectName
FROM Crime c
 JOIN Victim v ON c.CrimeID = v.CrimeID
 JOIN Suspect s ON c.CrimeID = s.CrimeID

 --15
SELECT DISTINCT s.CrimeID
FROM Suspect s
JOIN Victim v ON s.CrimeID = v.CrimeID
WHERE s.Age > ALL (
    SELECT v2.Age 
    FROM Victim v2 
    WHERE v2.CrimeID = s.CrimeID
)

--16
SELECT Name, COUNT(*) AS IncidentCount
FROM Suspect
GROUP BY Name
HAVING COUNT(*) > 1

--17
SELECT C.CrimeID, C.IncidentType
FROM Crime c
 JOIN Suspect s ON c.CrimeID = s.CrimeID
WHERE S.SuspectID IS NULL

--18
SELECT * FROM Crime
WHERE CrimeID IN (
    SELECT CrimeID FROM Crime
    GROUP BY CrimeID
    HAVING 
        COUNT(CASE WHEN IncidentType = 'Homicide' THEN 1 END) >= 1
        AND
        COUNT(CASE WHEN IncidentType NOT IN ('Homicide', 'Robbery') THEN 1 END) = 0)

--19
SELECT c.CrimeID,c.IncidentType,
  ISNULL(s.Name, 'No Suspect') AS SuspectName FROM Crime c
LEFT JOIN Suspect s ON c.CrimeID = s.CrimeID
ORDER BY c.CrimeID


--20
SELECT DISTINCT S.Name
FROM Suspect S
JOIN Crime C ON S.CrimeID = C.CrimeID
WHERE C.IncidentType IN ('Robbery', 'Assault')
